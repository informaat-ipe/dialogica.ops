#!/usr/bin/env bash

# SETTING `GLOBAL` VARIABLES
# Setting the `base dir` in this central location:
current_dir=$(cd $(dirname $0) && pwd)

# Set some default paths, normalize them:
base_dir=$(cd ${current_dir}/../../..; pwd)
client_dir=${base_dir}/client
server_dir=${base_dir}/server

# Set some colors for fancy logging
clear='\033[0m'     # no color
red='\033[0;31m'    # error
green='\033[0;32m'  # info
blue='\033[0;34m'   # log

echo -e "${green}[dialogica.ops/commonit]${clear} Sourced commonit"

echo -e "${blue}[dialogica.ops/commonit]${clear} Base directory:   $base_dir"
echo -e "${blue}[dialogica.ops/commonit]${clear} Client directory: $client_dir"
echo -e "${blue}[dialogica.ops/commonit]${clear} Server directory: $server_dir"

echo ""

# TODO: where is `ensure_node` defined? -- in Jenkins

# Set NODE_CMD
# TODO: this piece of code is repeated 14 times across this project, move this also into `commonit`?
# if [ -e "${OPS_HOME}/ops/bin/commonit" ]; then
#     source ${OPS_HOME}/ops/bin/commonit
#     ensure_node ${server_dir} # <-- this folder is the only part that changes
# else
#     NODE_CMD=
# fi


# UTILITY FUNCTIONS
function parse_repo_line() {
    line=$1
    set +e
    echo ${line} | grep ^#
    comment=$?
    echo ${line} | grep ^$
    empty=$?
    set -e
    NAME=''
    # skip lines starting with #
    if [ "${comment}" == "0" ]; then
        continue
    else
        # skip empty lines
        if [ "${empty}" == "0" ]; then
            continue
        else
            NAME=$(echo ${line} | cut -d ' ' -f1)
        fi
    fi
}